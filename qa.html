<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blog Management</title>
</head>
<body>

<!-- Thêm một nút để kích hoạt việc hiển thị form tạo bài đăng mới -->
<button id="showCreatePostFormButton" class="btn btn-success">Create Post</button>

<!-- Thêm form để tạo bài đăng mới (ban đầu được ẩn) -->
<form id="createPostForm" style="display: none;">
    <label for="title">Title:</label><br>
    <input type="text" id="title" name="title"><br>
    <label for="content">Content:</label><br>
    <textarea id="content" name="content"></textarea><br><br>
    <button type="submit" class="btn btn-primary">Submit</button>
</form>

<!-- Thêm một phần tử để hiển thị kết quả từ API -->
<table id="postTable" style="border-collapse: collapse;">
    <thead>
        <tr>
            <th>Title</th>
            <th>Content</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
document.addEventListener("DOMContentLoaded", function() {

    var showCreatePostFormButton = document.getElementById("showCreatePostFormButton");
    var createPostForm = document.getElementById("createPostForm");
    var postTableBody = document.querySelector("#postTable tbody");

    // Gắn sự kiện click cho nút showCreatePostFormButton
    showCreatePostFormButton.addEventListener("click", function() {
        createPostForm.style.display = "block";
        createPostForm.reset();
        createPostForm.setAttribute("data-action", "create");
    });

    // Gắn sự kiện submit cho form createPostForm
    createPostForm.addEventListener("submit", function(event) {
        event.preventDefault();

        var postData = {
            title: document.getElementById("title").value,
            content: document.getElementById("content").value
        };

        var action = createPostForm.getAttribute("data-action");

        if (action === "create") {
            // Gửi yêu cầu POST để tạo bài đăng mới
            fetch('http://localhost:3000/api/blog/create', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(postData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log('Bài đăng đã được tạo:', data);
                createPostForm.style.display = "none";
                loadPosts();
            })
            .catch(error => {
                console.error('Lỗi khi tạo bài đăng mới:', error);
            });
        } else if (action === "edit") {
            var postId = createPostForm.getAttribute("data-post-id");
            // Gửi yêu cầu PUT để cập nhật bài đăng
            fetch('http://192.168.0.110:3000/api/blog/update/' + postId, {
                method: 'PUT',
                headers: {
                    'Accept': '*/*',
      'Accept-Language': 'ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7,vi;q=0.6',
      'Content-Type': 'application/json',
      'Cookie': '_ga=GA1.1.1567824617.1706054484; __client_uat=0; __clerk_db_jwt=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJkZXYiOiJkdmJfMmJOWGFFWDgyQVZES2F4NVZqcDhKUldZc1J3In0.Lkhyw9EDQZqGQXBPF8pIJrza3cDEZpNEOBj0L7UAXFjiOrFm5sj4n5ghHi9cdC0GMda6mrACHSAQcd1GUIy3gxnqLZx8eKvvt1AlCVPRppQWl-vFJS6fuQ0X2bQCbfrZqnAyoz4PPqH-g9cKQtSd1FxTGI6bb_uUF5jI82GGOxN_0otvrm6JXShrOocZYI0YJrK8kno-UWWXR2YSQ8kFROOhkZckfFpf34iYShNtKl9SYg4vD6V6vJZodfCV8wNj_BB30gSuMkPE95j1JkVQulspvC-Wzi1m1I8z8aICQE3Ga-W48WPJRhrhNkw0Jf918uSMDZQbeCo1ig94_cLjVg; _ga_EZHDT2S2LF=GS1.1.1706076640.3.0.1706076640.60.0.0; connect.sid=s%3APv20ZPPBORskbGx7wT0o16FiukjYiIGd.sWoyBLYZuJ5OuMMuVPMGddBMmDrSlj6fLomAUVlYT50',
      'Origin': 'http://192.168.0.110:3000',
      'Referer': 'http://192.168.0.110:3000/blog/65e42dae4f83fafa32cfa74b',
      'Sec-Fetch-Dest': 'empty',
      'Sec-Fetch-Mode': 'cors',
      'Sec-Fetch-Site': 'same-origin',
      'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36',
      'sec-ch-ua': '"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',
      'sec-ch-ua-mobile': '?0',
      'sec-ch-ua-platform': '"Windows"'
                },
                body: JSON.stringify(postData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log('Bài đăng đã được cập nhật:', data);
                createPostForm.style.display = "none";
                loadPosts();
            })
            .catch(error => {
                console.error('Lỗi khi cập nhật bài đăng:', error);
            });
        }
    });

    // Gắn sự kiện click cho nút "Edit" của mỗi bài đăng
    postTableBody.addEventListener("click", function(event) {
        if (event.target.classList.contains("edit-button")) {
            var postId = event.target.getAttribute("data-id");
            createPostForm.style.display = "block";
            createPostForm.reset();
            createPostForm.setAttribute("data-action", "edit");
            createPostForm.setAttribute("data-post-id", postId);
            loadPostDataForEditing(postId);
        }
    });

    // Hàm để tải dữ liệu của bài đăng để chỉnh sửa
    function loadPostDataForEditing(postId) {
        var rows = postTableBody.querySelectorAll("tr");
        rows.forEach(row => {
            var id = row.querySelector(".edit-button").getAttribute("data-id");
            if (id === postId) {
                var title = row.cells[0].textContent;
                var content = row.cells[1].textContent;
                document.getElementById("title").value = title;
                document.getElementById("content").value = content;
                return;
            }
        });
    }

    // Hàm để tải danh sách bài đăng
    function loadPosts() {
        fetch('http://192.168.0.110:3000/api/blog/all', {
            method: 'GET',
            headers: {
                'Accept': '*/*',
                'Accept-Language': 'en-US,en;q=0.9,vi;q=0.8',
                'Connection': 'keep-alive',
                'If-None-Match': 'W/"1db-M02Bg9QMa6jcrG3qMjJPb/d68n0"',
                'Referer': 'http://localhost:3000/',
                'Sec-Fetch-Dest': 'empty',
                'Sec-Fetch-Mode': 'cors',
                'Sec-Fetch-Site': 'same-origin',
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36',
                'sec-ch-ua': '"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',
                'sec-ch-ua-mobile': '?0',
                'sec-ch-ua-platform': '"Windows"',
                'Cache-Control': 'no-cache'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            postTableBody.innerHTML = "";
            data.forEach(post => {
                var row = postTableBody.insertRow();
                row.insertCell().textContent = post.title;
                row.insertCell().textContent = post.content;
                var editButton = document.createElement("button");
                editButton.textContent = "Edit";
                editButton.setAttribute("data-id", post._id);
                editButton.classList.add("edit-button");
                row.insertCell().appendChild(editButton);
            });
        })
        .catch(error => {
            console.error('Lỗi khi tải danh sách bài đăng:', error);
        });
    }

    // Ban đầu, tải danh sách bài đăng khi trang được tải
    loadPosts();
});
</script>

</body>
</html>
